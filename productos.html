<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Blog informativo de Biotecnologías RLD">
    <title>Nuestros Productos</title>
    <link rel="icon" href="img/Logo_Final.jpg">
    <link rel="prefetch" href="nosotros.html" as="DOCTYPE">
    <link rel="preconnect" href="css/normalize.css" as="stylesheet">
    <link rel="stylesheet" href="css/normalize.css">
    <link rel="preconnect" href="css/style.css" as="styles">
    <link rel="stylesheet" href="css/style.css">
    <link rel="preload" href="img/Logo_Final.jpg" as="image">
    <link rel="preload" href="img/invernaderos1.png" as="image">
</head>
<body>
  <div class="carrito-icono" id="btn-abrir-carrito" onclick="toggleCarrito()">
    🛒 <span id="contador-carrito">0</span>
</div>

    <header class="header6">
        <div class="contenedor">
            <div class="barra">
                <a class="logo" href="index.html">
                    <h1 class="logo__nombre no-margin centrar-texto" style="color: black;">Biotecnologías<span class="logo__bold">RLD</span></h1>
                </a>
                <nav class="navegacion">
                    <a href="nosotros.html" class="navegacion__enlace2" style="color: black;">Nosotros</a>
                    <a href="visitas.html" class="navegacion__enlace2" style="color: black;">Visitas</a>
                    <a href="contacto.html" class="navegacion__enlace2" style="color: black;">Contacto</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="productos">
        <h1 style="text-align: center;">Conoce nuestros productos</h1>
        <img src="img/prompt.png" alt="prompt" style="border:solid rgb(163, 165, 34); border-radius: 2rem;">
  <!-- Producto 1 -->
  <div class="producto">
    <div class="carrusel">
      <div class="carrusel-inner">
        <div class="carrusel-item"><img src="img/500g.jpg" alt="Producto 1 img1"></div>
        <div class="carrusel-item"><img src="img/bsf1.jpeg" alt="Producto 1 img2"></div>
        <div class="carrusel-item">
          <video src="img/sponsor.mp4" autoplay muted loop></video>
        </div>
      </div>
    </div>
    <h4 style="text-align: center;">Suplemento para Aves: Larva Mosca Soldado Negra 500 g</h4>
    <p style="text-align: center; font-weight: bold;">¡El alimento ideal para tus animales! </p>
    <p style="text-align: justify;">Descubre nuestra larva de mosca soldado negra deshidratada, una fuente de proteína premium diseñada para satisfacer las necesidades nutricionales de tus animales. Alimento 100% natural.</p>
    <div class="producto-info">
    <label for="cantidad1">Cantidad:</label>
    <input type="number" id="cantidad1" min="1" max="10" value="1" class="input-cantidad">
    <p class="precio-producto">Precio: $<span id="precio1">400</span></p>
    <button onclick="agregarAlCarrito('Larva deshidratada 500g', 'img/500g.jpg', 400, document.getElementById('cantidad1').value)" class="boton boton--agregar">Agregar al carrito</button>
    </div>
  </div>

  <!-- Producto 2 -->
  <div class="producto">
    <div class="carrusel">
      <div class="carrusel-inner">
            <div class="carrusel-item">
                <img src="img/1000g.jpg" alt="Producto 2 img1">
            </div>
            <div class="carrusel-item">
                <img src="img/1kgp2.jpg" alt="Producto 2 img2">
            </div>
            <div class="carrusel-item">
               <video src="img/sponsor.mp4" autoplay muted loop></video>
            </div>
      </div>
    </div>
    <h4 style="text-align: center;">Suplemento para Aves: Larva Mosca Solado Negra 1 Kg</h4>
    <p style="text-align: center; font-weight: bold;">Beneficios comprobados: </p>
        <p style="text-align: justify; margin-bottom: -2rem;">- Mejora la digestión y absorción de nutrientes.</p>
        <p style="text-align: justify;margin-bottom: -2rem;">- Promueve un sistema inmunológico más fuerte.</p>
        <p style="text-align: justify; margin-bottom: 0.3rem">- Incrementa la energía y vitalidad de tus animales.</p>
    <div class="producto-info">
    <label for="cantidad1">Cantidad:</label>
    <input type="number" id="cantidad1" min="1" max="10" value="1" class="input-cantidad">
    <p class="precio-producto">Precio: $<span id="precio1">600</span></p>
    <button onclick="agregarAlCarrito('Larva deshidratada 1 Kg', 'img/1000g.jpg', 600, document.getElementById('cantidad1').value)" class="boton boton--agregar">Agregar al carrito</button>
    </div>
  </div>
<!-- Producto 3 -->
  <div class="producto">
    <div class="carrusel">
      <div class="carrusel-inner">
            <div class="carrusel-item">
                <img src="img/bsf1.jpeg" alt="Producto 2 img1">
            </div>
            <div class="carrusel-item">
                <video src="img/sponsor2.mp4" autoplay muted loop></video>
            </div>
            <div class="carrusel-item">
                <video src="img/viva1.mp4" autoplay muted loop></video>
            </div>
      </div>
    </div>
    <h4 style="text-align: center;">Larva Viva de Mosca Soldado Negro 250 pz</h4>
    <p style="text-align: center; font-weight: bold;">Larva Viva: proteína que se mueve.</p>
        <p style="text-align: justify; margin-bottom: -2rem;">Fuente rica en proteína y grasa ideal para la alimentación de aves y reptiles. Criadas con residuos orgánicos seleccionados, nuestras larvas son una opción sustentable, fresca y altamente nutritiva. Se entregan vivas, listas para consumo o engorda.</p>
        <br>
    <div class="producto-info">
    <label for="cantidad1">Cantidad:</label>
    <input type="number" id="cantidad1" min="1" max="10" value="1" class="input-cantidad">
    <p class="precio-producto">Precio: $<span id="precio1">350</span></p>
    <button onclick="agregarAlCarrito('Larva viva 250 u', 'img/bsf1.jpeg', 350, document.getElementById('cantidad1').value)" class="boton boton--agregar">Agregar al carrito</button>
    </div>
  </div>
</main>
<div id="carrito" class="carrito oculto">
    <h3 style="text-align: center;">Tu Carrito</h3>
    <div id="carrito-items"></div>
    <p id="envio-gratis" style="color: green; font-weight: bold; display: none;">¡Tienes envío gratis!</p>
    <p style="text-align: center; font-weight: bolder;">Total: $<span id="total">0</span></p>
    <button id="btn-pagar" onclick="mostrarFormularioPago()" class="boton boton--pagar">Pagar</button>
</div>
<div id="formularioPago" class="modal oculto">
    <h3 class="modal-title">Datos de Envío</h3>
    <form id="form-datos" action="https://formspree.io/f/myzpejjo" method="POST">
        <input type="text" name="nombre" placeholder="Nombre y Apellido" required>
        <input type="text" name="telefono" placeholder="Número de contacto" required>
        <input type="email" name="correo" placeholder="Correo electrónico" required>
        <input type="text" name="calle" placeholder="Calle y número" required>
        <input type="text" name="colonia" placeholder="Colonia" required>
        <input type="text" name="municipio" placeholder="Municipio o Delegación" required>
        <input type="text" name="estado" placeholder="Estado" required>
        <input type="text" name="cp" placeholder="Código Postal" required>
        <input type="hidden" name="pedido" id="form-pedido">
        <input type="hidden" name="total" id="total-final">
        <div class="modal-botones">
            <button type="button" onclick="enviarFormularioYSPEI()" class="boton boton--pagar">Pagar Vía SPEI</button>
        </div>
    </form>
</div>
<div id="modal-overlay" class="oculto overlay" onclick="cerrarFormularioPago()"></div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
function generarNumeroPedidoAleatorio() {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
  let resultado = '';
  for (let i = 0; i < 4; i++) {
    resultado += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return 'PED-' + resultado;
}
let numeroPedido = "";
let carrito = [];
let total = 0;
const ENVIO_GRATIS_MIN = 500;
const COSTO_ENVIO = 150;

function toggleCarrito() {
    document.getElementById("carrito").classList.toggle("oculto");
}

function agregarAlCarrito(nombre, imagen, precio, cantidad) {
    cantidad = parseInt(cantidad);

    if (isNaN(cantidad) || cantidad < 1) {
        Swal.fire({
            icon: 'warning',
            title: 'Cantidad inválida',
            text: 'Debes ingresar al menos 1 unidad.',
            timer: 2000,
            showConfirmButton: false,
            timerProgressBar: true,
            customClass: {
                popup: 'my-timer'
            }
        });
        return;
    }

    // Buscar si ya existe el producto en el carrito
    const existente = carrito.find(item => item.nombre === nombre);

    if (existente) {
        const nuevaCantidad = existente.cantidad + cantidad;
        if (nuevaCantidad > 10) {
            Swal.fire({
                icon: 'warning',
                title: 'Límite excedido',
                text: 'Sólo puedes tener hasta 10 unidades por producto.',
                timer: 2000,
                showConfirmButton: false,
                timerProgressBar: true,
                customClass: {
                    popup: 'my-timer'
                }
            });
            return;
        }
        existente.cantidad = nuevaCantidad;
    } else {
        if (cantidad > 10) {
            Swal.fire({
                icon: 'warning',
                title: 'Demasiado producto',
                text: 'Sólo puedes agregar un máximo de 10 unidades por producto.',
                timer: 2000,
                showConfirmButton: false,
                timerProgressBar: true,
                customClass: {
                    popup: 'my-timer'
                }
            });
            return;
        }

        const producto = { nombre, imagen, precio, cantidad };
        carrito.push(producto);
    }

    actualizarCarrito();
}


function eliminarDelCarrito(index) {
    carrito.splice(index, 1);
    actualizarCarrito();
}

// function actualizarCarrito() {
//    const carritoItems = document.getElementById("carrito-items");
//     carritoItems.innerHTML = '';
//     total = 0;
// document.getElementById("btn-pagar").disabled = carrito.length === 0;
//     if (carrito.length === 0) {
//         carritoItems.innerHTML = '<p>Tu carrito está vacío.</p>';
//         document.getElementById("envio-gratis").style.display = "none";
//         document.getElementById("total").textContent = "0";
//         document.getElementById("contador-carrito").textContent = "0";
//         return;
//     }

//     carrito.forEach((item, index) => {
//         const subtotal = item.precio * item.cantidad;
//         total += subtotal;

//         carritoItems.innerHTML += `
//             <div class="carrito-item">
//                 <img src="${item.imagen}" alt="${item.nombre}">
//                 <div class="carrito-detalle">
//                     <span>${item.nombre}</span>
//                     <div class="carrito-controles">
//                         <button onclick="cambiarCantidad(${index}, -1)">−</button>
//                         <span>${item.cantidad}</span>
//                         <button onclick="cambiarCantidad(${index}, 1)">+</button>
//                         <span>$${subtotal}</span>
//                         <button onclick="eliminarDelCarrito(${index})">❌</button>
//                     </div>
//                 </div>
//             </div>
//         `;
//     });

//     const envioGratis = document.getElementById("envio-gratis");
//     if (total >= ENVIO_GRATIS_MIN) {
//         envioGratis.style.color = "green";
//         envioGratis.innerText = "¡Tienes envío gratis!";
//         envioGratis.style.display = "block";
//         document.getElementById("total").textContent = total;
//     } else {
//         envioGratis.style.color = "red";
//         envioGratis.innerText = "Costo de envío: $150";
//         envioGratis.style.display = "block";
//         document.getElementById("total").textContent = total + COSTO_ENVIO;
//     }

//     document.getElementById("contador-carrito").textContent = carrito.length;
//     const btnPagar = document.getElementById("btn-pagar");
//     if (carrito.length === 0) {
//         carritoItems.innerHTML = '<p>Tu carrito está vacío.</p>';
//         document.getElementById("total").textContent = "0";
//         document.getElementById("contador-carrito").textContent = "0";
//         btnPagar.style.display = "none";
//         return;
//     } else {
//         btnPagar.style.display = "inline-block";
//     }
    
// }
function actualizarCarrito() {
    const carritoItems = document.getElementById("carrito-items");
    const btnPagar = document.getElementById("btn-pagar");
    const envioGratis = document.getElementById("envio-gratis");

    carritoItems.innerHTML = '';
    let total = 0;

    // Mostrar u ocultar el botón de pagar y estado visual
    if (carrito.length === 0) {
        carritoItems.innerHTML = '<p style="text-align: center;">Tu carrito está vacío.</p>';
        document.getElementById("total").textContent = "0";
        document.getElementById("contador-carrito").textContent = "0";
        envioGratis.style.display = "none";
        return;
    } else {
        btnPagar.style.display = "inline-block"; // Muestra el botón
        btnPagar.disabled = false;               // Activa el botón
    }

    carrito.forEach((item, index) => {
        const subtotal = item.precio * item.cantidad;
        total += subtotal;

        carritoItems.innerHTML += `
            <div class="carrito-item">
                <img src="${item.imagen}" alt="${item.nombre}">
                <div class="carrito-detalle">
                    <span>${item.nombre}</span>
                    <div class="carrito-controles">
                        <button onclick="cambiarCantidad(${index}, -1)">−</button>
                        <span>${item.cantidad}</span>
                        <button onclick="cambiarCantidad(${index}, 1)">+</button>
                        <span>$${subtotal}</span>
                        <button onclick="eliminarDelCarrito(${index})">❌</button>
                    </div>
                </div>
            </div>
        `;
    });

    if (total >= ENVIO_GRATIS_MIN) {
        envioGratis.style.color = "green";
        envioGratis.innerText = "¡Tienes envío gratis!";
        envioGratis.style.display = "block";
        document.getElementById("total").textContent = total;
    } else {
        envioGratis.style.color = "red";
        envioGratis.innerText = "Costo de envío: $150";
        envioGratis.style.display = "block";
        document.getElementById("total").textContent = total + COSTO_ENVIO;
    }

    document.getElementById("contador-carrito").textContent = carrito.length;
}

// function cambiarCantidad(index, cambio) {
//     carrito[index].cantidad += cambio;
//     if (carrito[index].cantidad <= 0) {
//         carrito.splice(index, 1); // elimina si la cantidad es 0
//     }
//     actualizarCarrito();
// }
function cambiarCantidad(index, cambio) {
    if (!carrito[index]) return;

    let nuevaCantidad = carrito[index].cantidad + cambio;

    // Limitar a mínimo 1 y máximo 10 unidades
    if (nuevaCantidad < 1) {
        nuevaCantidad = 1;
    } else if (nuevaCantidad > 10) {
        nuevaCantidad = 10;
        Swal.fire({
            icon: 'error',
            title: 'Límite excedido',
            text: 'Sólo puedes agregar un máximo de 10 unidades por producto.',
            showConfirmButton: false,
             timerProgressBar: true,
              customClass: {
              popup: 'my-timer'  // Aplica la clase para personalizar el estilo
              },
            timer: 1900
        });
    }

    carrito[index].cantidad = nuevaCantidad;
    actualizarCarrito();
}


function mostrarFormularioPago() {
  if (carrito.length === 0) return; // No hacer nada si el carrito está vacío
    numeroPedido = generarNumeroPedidoAleatorio();
    document.getElementById("form-pedido").value = numeroPedido;
    const totalFinal = total >= ENVIO_GRATIS_MIN ? total : total + COSTO_ENVIO;
    document.getElementById("total-final").value = totalFinal;

    document.getElementById("formularioPago").classList.remove("oculto");
    document.getElementById("modal-overlay").classList.remove("oculto");

    // Establecer el total actual al input oculto
    document.getElementById("total-final").value = total;
}


function cerrarFormularioPago() {
    document.getElementById("formularioPago").classList.add("oculto");
    document.getElementById("modal-overlay").classList.add("oculto");
}

function enviarFormularioYSPEI() {
    // Asegurarse de que el número de pedido esté en el formulario
    document.getElementById("form-pedido").value = numeroPedido;

    const form = document.getElementById("form-datos");

    if (!form.checkValidity()) {
        form.reportValidity();
        return;
    }

    // Obtener el total desde el DOM y asegurarse de que sea un número
    const totalDOM = parseFloat(document.getElementById("total").innerText) || 0;
    const envioGratisMin = typeof ENVIO_GRATIS_MIN !== "undefined" ? ENVIO_GRATIS_MIN : 500;
    const costoEnvio = typeof COSTO_ENVIO !== "undefined" ? COSTO_ENVIO : 150;

    const totalFinal = totalDOM >= envioGratisMin ? totalDOM : totalDOM + costoEnvio;

    // Asignar al campo oculto
    document.getElementById("total-final").value = totalFinal;

    const formData = new FormData(form);

    fetch(form.action, {
        method: "POST",
        body: formData,
        headers: { 'Accept': 'application/json' }
    }).then(response => {
        if (response.ok) {
            cerrarFormularioPago();

            Swal.fire({
                title: 'Pago por SPEI',
                html: `
                    <p><strong>Banco:</strong> BBVA<br>
                    <strong>Cuenta:</strong> 0123456789<br>
                    <strong>CLABE:</strong> 012345678901234567<br>
                    <strong>Total:</strong> $${totalFinal}<br>
                    <strong>Concepto:</strong> ${numeroPedido}<br><br>
                    Enviar comprobante a: <br>
                    <a href="mailto:kromero@rld.mx">kromero@rld.mx</a> o por <a href="https://wa.me/5214421234567" target="_blank">WhatsApp</a> <br>
                    <strong>Una vez recibido el comprobante, te enviaremos el número de rastreo de tu producto.</strong>
                    </p>
                `,
                icon: 'info',
                confirmButtonText: 'Entendido',
                allowOutsideClick: true
            });

            reiniciarCarrito();
            document.getElementById("carrito").classList.add("oculto");
        } else {
            Swal.fire("Error", "No se pudo enviar el formulario. Inténtalo más tarde.", "error");
        }
    }).catch(error => {
        Swal.fire("Error", "Hubo un problema enviando el formulario.", "error");
    });
}


function reiniciarCarrito() {
    carrito = [];
    total = 0;
    actualizarCarrito();
}
document.querySelectorAll(".input-cantidad").forEach(input => {
    input.addEventListener("input", function () {
        if (parseInt(this.value) > 10) {
            this.value = 10;
        } else if (parseInt(this.value) < 1 || isNaN(this.value)) {
            this.value = 1;
        }
    });
});

</script>

<!-- CONTADOR DE VISITAS -->
<div id="sfcwrmlqrfdsbyqc9sldnlb16sd4p81pfa8"></div><script type="text/javascript" src="https://counter1.optistats.ovh/private/counter.js?c=wrmlqrfdsbyqc9sldnlb16sd4p81pfa8&down=async" async></script><br><a href="https://www.freecounterstat.com"></a><noscript><a href="https://www.freecounterstat.com" title="hit counter"><img src="https://counter1.optistats.ovh/private/freecounterstat.php?c=wrmlqrfdsbyqc9sldnlb16sd4p81pfa8" border="0" title="hit counter" alt="hit counter"></a></noscript>
</body>
<footer class="footer">
    <div class="barra">
        <a class="logo" href="index.html">
            <img src="img/Logo_Final.jpg" alt="logo" style="width: 10rem; height: 10rem; margin: 1.5rem;">
        </a>
        <p style="color: white; font-size: 1rem; margin: 1rem;">© BIOTECNOLOGÍAS RLD | TODOS LOS DERECHOS RESERVADOS | <a href="avisolegal.html" style="color: white;" target="_blank">AVISO LEGAL</a> | <a href="avisoprivacidad.html" style="color: white;" target="_blank">AVISO DE PRIVACIDAD</a> |</p>
        <nav class="navegacion">
            <a href="nosotros.html" class="navegacion__enlace">Nosotros</a>
            <a href="visitas.html" class="navegacion__enlace">Visitas</a>
            <a href="contacto.html" class="navegacion__enlace">Contacto</a>
        </nav>
    </div>
</div>
</footer>
</html>